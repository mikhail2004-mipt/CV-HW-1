# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ CNN –∏ ViT-Tiny –¥–ª—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π

–ü—Ä–æ–µ–∫—Ç —Å—Ä–∞–≤–Ω–∏–≤–∞–µ—Ç –¥–≤–µ –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –Ω–µ–π—Ä–æ–Ω–Ω—ã—Ö —Å–µ—Ç–µ–π –¥–ª—è –∑–∞–¥–∞—á–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π: –ø—Ä–æ—Å—Ç—É—é —Å–≤–µ—Ä—Ç–æ—á–Ω—É—é —Å–µ—Ç—å (CNN) –∏ Vision Transformer Tiny (ViT-Tiny) —Å linear probe.

## üìã –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–ø–∏—Å–∞–Ω–∏–µ](#–æ–ø–∏—Å–∞–Ω–∏–µ)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–µ–π](#–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã-–º–æ–¥–µ–ª–µ–π)
- [–î–∞—Ç–∞—Å–µ—Ç](#–¥–∞—Ç–∞—Å–µ—Ç)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞)
- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ](#–∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ)
- [–†–µ–∑—É–ª—å—Ç–∞—Ç—ã](#—Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã)

## üéØ –û–ø–∏—Å–∞–Ω–∏–µ

–ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç –ø–æ–ª–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω –º–∞—à–∏–Ω–Ω–æ–≥–æ –æ–±—É—á–µ–Ω–∏—è:
- –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö —Å –∞—É–≥–º–µ–Ω—Ç–∞—Ü–∏—è–º–∏
- –û–±—É—á–µ–Ω–∏–µ –¥–≤—É—Ö –º–æ–¥–µ–ª–µ–π (CNN –∏ ViT-Tiny)
- –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- –û—Ü–µ–Ω–∫–∞ –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã –º–æ–¥–µ–ª–µ–π

### SimpleCNN

–ü—Ä–æ—Å—Ç–∞—è —Å–≤–µ—Ä—Ç–æ—á–Ω–∞—è –Ω–µ–π—Ä–æ–Ω–Ω–∞—è —Å–µ—Ç—å —Å —Ç—Ä–µ–º—è —Å–≤–µ—Ä—Ç–æ—á–Ω—ã–º–∏ –±–ª–æ–∫–∞–º–∏:

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- **–ë–ª–æ–∫ 1:** Conv2d(3‚Üí64) + BatchNorm + ReLU + MaxPool
- **–ë–ª–æ–∫ 2:** Conv2d(64‚Üí128) + BatchNorm + ReLU + MaxPool
- **–ë–ª–æ–∫ 3:** Conv2d(128‚Üí256) + BatchNorm + ReLU + MaxPool
- **Pooling:** AdaptiveAvgPool2d(7√ó7)
- **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä:** FC(256√ó7√ó7‚Üí512) + Dropout(0.5) + FC(512‚Üínum_classes)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- Kaiming –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Å–æ–≤ –¥–ª—è ReLU
- Batch Normalization –¥–ª—è —Å—Ç–∞–±–∏–ª–∏–∑–∞—Ü–∏–∏ –æ–±—É—á–µ–Ω–∏—è
- Dropout –¥–ª—è —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏

### ViTLinearProbe

Vision Transformer Tiny —Å –∑–∞–º–æ—Ä–æ–∂–µ–Ω–Ω—ã–º backbone –∏ –æ–±—É—á–∞–µ–º–æ–π –ª–∏–Ω–µ–π–Ω–æ–π –≥–æ–ª–æ–≤–æ–π:

**–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞:**
- **Backbone:** –ü—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω–∞—è ViT-Tiny (`vit_tiny_patch16_224`)
- **–†–∞–∑–º–µ—Ä–Ω–æ—Å—Ç—å –ø—Ä–∏–∑–Ω–∞–∫–æ–≤:** 192
- **–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä:** Linear(192‚Üínum_classes)

**–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏:**
- –í—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã backbone –∑–∞–º–æ—Ä–æ–∂–µ–Ω—ã (`requires_grad=False`)
- –û–±—É—á–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –ª–∏–Ω–µ–π–Ω–∞—è –≥–æ–ª–æ–≤–∞
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –ø—Ä–µ–¥–æ–±—É—á–µ–Ω–Ω—ã–µ –≤–µ—Å–∞ ImageNet

**–í–∞—Ä–∏–∞–Ω—Ç —Å Dropout:**
- –î–æ–±–∞–≤–ª–µ–Ω Dropout(0.1) –ø–µ—Ä–µ–¥ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ç–æ—Ä–æ–º –¥–ª—è –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ–π —Ä–µ–≥—É–ª—è—Ä–∏–∑–∞—Ü–∏–∏

## üìä –î–∞—Ç–∞—Å–µ—Ç

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–∞—Ç–∞—Å–µ—Ç **STL-10**:
- 10 –∫–ª–∞—Å—Å–æ–≤ –æ–±—ä–µ–∫—Ç–æ–≤
- –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ä–∞–∑–º–µ—Ä–æ–º 96√ó96 (—Ä–µ—Å–∞–π–∑—è—Ç—Å—è –¥–æ 224√ó224)
- –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ: 80% train / 20% validation

**–ö–ª–∞—Å—Å—ã:** airplane, bird, car, cat, deer, dog, horse, monkey, ship, truck

**–ê—É–≥–º–µ–Ω—Ç–∞—Ü–∏–∏ (train):**
- RandomResizedCrop(224, scale=(0.8, 1.0))
- RandomHorizontalFlip(p=0.5)
- ColorJitter(brightness=0.2, contrast=0.2, saturation=0.2)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ImageNet

**–¢—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ (val):**
- Resize(256)
- CenterCrop(224)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è ImageNet

## üîß –£—Å—Ç–∞–Ω–æ–≤–∫–∞

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
pip install torch torchvision
pip install timm  # –¥–ª—è ViT –º–æ–¥–µ–ª–∏
pip install numpy matplotlib seaborn
pip install scikit-learn
pip install tqdm
pip install tensorboard
```

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

- Python 3.8+
- PyTorch 1.10+
- CUDA (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –¥–ª—è GPU)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
.
‚îú‚îÄ‚îÄ data/                      # –î–∞—Ç–∞—Å–µ—Ç STL-10
‚îÇ   ‚îú‚îÄ‚îÄ train/                # –û–±—É—á–∞—é—â–∞—è –≤—ã–±–æ—Ä–∫–∞
‚îÇ   ‚îî‚îÄ‚îÄ val/                  # –í–∞–ª–∏–¥–∞—Ü–∏–æ–Ω–Ω–∞—è –≤—ã–±–æ—Ä–∫–∞
‚îú‚îÄ‚îÄ checkpoints/              # –°–æ—Ö—Ä–∞–Ω–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ cnn_best.pth         # –õ—É—á—à–∞—è CNN –º–æ–¥–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ cnn_final.pth        # –§–∏–Ω–∞–ª—å–Ω–∞—è CNN –º–æ–¥–µ–ª—å
‚îÇ   ‚îú‚îÄ‚îÄ vit_best.pth         # –õ—É—á—à–∞—è ViT –º–æ–¥–µ–ª—å
‚îÇ   ‚îî‚îÄ‚îÄ vit_final.pth        # –§–∏–Ω–∞–ª—å–Ω–∞—è ViT –º–æ–¥–µ–ª—å
‚îú‚îÄ‚îÄ runs/                     # TensorBoard –ª–æ–≥–∏
‚îú‚îÄ‚îÄ traces/                   # –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ profiler_trace_cnn.json
‚îÇ   ‚îú‚îÄ‚îÄ profiler_trace_vit.json
‚îÇ   ‚îú‚îÄ‚îÄ confusion_matrix_cnn.png
‚îÇ   ‚îú‚îÄ‚îÄ confusion_matrix_vit.png
‚îÇ   ‚îî‚îÄ‚îÄ metrics.csv
‚îî‚îÄ‚îÄ Untitled2 (1).ipynb      # –û—Å–Ω–æ–≤–Ω–æ–π –Ω–æ—É—Ç–±—É–∫
```

## üöÄ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

```python
from pathlib import Path
from torchvision.datasets import STL10

DIR_PATH = Path("./data")
TRAIN_ROOT = DIR_PATH / 'train'
VAL_ROOT = DIR_PATH / 'val'

# –≠–∫—Å–ø–æ—Ä—Ç STL-10 –≤ —Ñ–æ—Ä–º–∞—Ç ImageFolder
export_stl10_to_imagefolder(DIR_PATH, TRAIN_ROOT, VAL_ROOT)

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞—Ç–∞—Å–µ—Ç–∞
verify_dataset(DIR_PATH)
```

### 2. –û–±—É—á–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

**CNN:**
```python
train_model(
    model_name='cnn',
    data_dir=DIR_PATH,
    epochs=20,
    batch_size=32,
    lr=0.001,
    seed=42,
    num_workers=4,
    sanity_check_bool=False,
    num_batches=5
)
```

**ViT-Tiny:**
```python
train_model(
    model_name='vit',
    data_dir=DIR_PATH,
    epochs=20,
    batch_size=32,
    lr=0.01,
    seed=42,
    num_workers=4,
    sanity_check_bool=False,
    num_batches=5
)
```

### 3. –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ

```python
# –ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±–µ–∏—Ö –º–æ–¥–µ–ª–µ–π
profiles = {}

# CNN
cnn_model = SimpleCNN(num_classes=num_classes).to(device)
cnn_prof = profile_model(cnn_model, train_loader, device, 
                         num_steps=100, model_name='cnn')

# ViT
vit_model = ViTLinearProbe(num_classes=num_classes).to(device)
vit_prof = profile_model(vit_model, train_loader, device,
                         num_steps=100, model_name='vit')

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
compare_models(cnn_prof, vit_prof, output_dir='./traces')
```

### 4. –û—Ü–µ–Ω–∫–∞ –º–æ–¥–µ–ª–µ–π

```python
# –ó–∞–≥—Ä—É–∑–∫–∞ –º–æ–¥–µ–ª–µ–π
cnn_model = load_model('./checkpoints/cnn_best.pth', 'cnn', num_classes, device)
vit_model = load_model('./checkpoints/vit_best.pth', 'vit', num_classes, device)

# –û—Ü–µ–Ω–∫–∞
cnn_results = evaluate_model(cnn_model, val_loader, device, class_names)
vit_results = evaluate_model(vit_model, val_loader, device, class_names)

# –°—Ä–∞–≤–Ω–µ–Ω–∏–µ
compare_models(cnn_results, vit_results, output_dir='./traces')
```

## üìà –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ú–µ—Ç—Ä–∏–∫–∏

–†–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `traces/metrics.csv`:
- **Accuracy** - —Ç–æ—á–Ω–æ—Å—Ç—å –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- **Macro F1** - —É—Å—Ä–µ–¥–Ω–µ–Ω–Ω–∞—è F1-–º–µ—Ä–∞ –ø–æ –≤—Å–µ–º –∫–ª–∞—Å—Å–∞–º
- **Parameters** - –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—É—á–∞–µ–º—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

### –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

**Confusion Matrix:**
- `traces/confusion_matrix_cnn.png` - –º–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ –¥–ª—è CNN
- `traces/confusion_matrix_vit.png` - –º–∞—Ç—Ä–∏—Ü–∞ –æ—à–∏–±–æ–∫ –¥–ª—è ViT

**TensorBoard:**
```bash
tensorboard --logdir runs
```

–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏:
- Train/Val Loss –∏ Accuracy
- Learning Rate
- –í–µ—Å–∞ –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã –º–æ–¥–µ–ª–µ–π

**–ü—Ä–æ—Ñ–∏–ª–∏—Ä–æ–≤–∞–Ω–∏–µ:**
- Chrome Tracing: –æ—Ç–∫—Ä–æ–π—Ç–µ `chrome://tracing` –∏ –∑–∞–≥—Ä—É–∑–∏—Ç–µ `traces/profiler_trace_*.json`
- –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ CPU/CUDA –≤ `traces/profiler_stats_*.txt`

### –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –º–æ–¥–µ–ª–µ–π

–î–µ—Ç–∞–ª—å–Ω–æ–µ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `traces/model_comparison.txt`:
- Accuracy –∏ F1-score –¥–ª—è –∫–∞–∂–¥–æ–π –º–æ–¥–µ–ª–∏
- Classification report –ø–æ –∫–ª–∞—Å—Å–∞–º
- –†–∞–∑–Ω–∏—Ü–∞ –≤ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

## üîç –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –í–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏–º–æ—Å—Ç—å
- –§–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π seed (42) –¥–ª—è –≤—Å–µ—Ö –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ —Å–ª—É—á–∞–π–Ω—ã—Ö —á–∏—Å–µ–ª
- –î–µ—Ç–µ—Ä–º–∏–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ CUDA

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è
- **CNN:** Adam optimizer (lr=0.001, weight_decay=1e-4)
- **ViT:** SGD optimizer (lr=0.01, momentum=0.9, weight_decay=1e-4)
- Cosine Annealing LR scheduler

### Sanity Check
–†–µ–∂–∏–º –ø—Ä–æ–≤–µ—Ä–∫–∏ —Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ –º–æ–¥–µ–ª–∏ –ø–µ—Ä–µ–æ–±—É—á–∏—Ç—å—Å—è –Ω–∞ –º–∞–ª–æ–º –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ –¥–∞–Ω–Ω—ã—Ö:
```python
train_model(..., sanity_check_bool=True, num_batches=5)
```

### –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- TensorBoard –¥–ª—è –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –æ–±—É—á–µ–Ω–∏—è
- –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ª—É—á—à–µ–π –∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–π –º–æ–¥–µ–ª–µ–π
- –ì–∏—Å—Ç–æ–≥—Ä–∞–º–º—ã –≤–µ—Å–æ–≤ –∏ –≥—Ä–∞–¥–∏–µ–Ω—Ç–æ–≤

## üìù –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- –î–ª—è GPU —Ç—Ä–µ–±—É–µ—Ç—Å—è CUDA-—Å–æ–≤–º–µ—Å—Ç–∏–º–∞—è –≤–∏–¥–µ–æ–∫–∞—Ä—Ç–∞
- –†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–π –æ–±—ä–µ–º GPU –ø–∞–º—è—Ç–∏: 4GB+
- –í—Ä–µ–º—è –æ–±—É—á–µ–Ω–∏—è –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –∂–µ–ª–µ–∑–∞ (CPU: ~2-3 —á–∞—Å–∞, GPU: ~20-30 –º–∏–Ω—É—Ç)
